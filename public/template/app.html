<script type="text/ng-template" id="addList.html">
	<div class="modal-header">
		<h3 class="modal-title">Создать новый список</h3>
	</div>
	<div class="modal-body">
		<input type="text" placeholder="Название" ng-model="newListName" class="newListName" ng-keyup="$event.keyCode == 13 && newListName && save()" autofocus></input>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="save()" ng-disabled="!newListName">Сохранить</button>
		<button class="btn btn-danger" ng-click="cancel()">Отмена</button>
	</div>
</script>

<script type="text/ng-template" id="renameList.html">
	<div class="modal-header">
		<h3 class="modal-title">Переименовать</h3>
	</div>
	<div class="modal-body">
		<input type="text" placeholder="Название" ng-model="newListName" class="newListName" ng-keyup="$event.keyCode == 13 && newListName && save()" autofocus></input>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="save()" ng-disabled="!newListName">Сохранить</button>
		<button class="btn btn-danger" ng-click="cancel()">Отмена</button>
	</div>
</script>

<script type="text/ng-template" id="removeList.html">
	<div class="modal-body">
		<h4 class="modal-title modalTitle">{{listName}} будет удалён навсегда</h4>
	</div>
	<div class="modal-footer">
		<button class="btn btn-danger" ng-click="save()">Удалить список</button>
		<button class="btn btn-primary" ng-click="cancel()">Отмена</button>
	</div>
</script>

<script type="text/ng-template" id="leaveList.html">
	<div class="modal-body">
		<h4 class="modal-title modalTitle">Вы действительно хотите покинуть список {{listName}}?</h4>
	</div>
	<div class="modal-footer">
		<button class="btn btn-danger" ng-click="save()">Покинуть список</button>
		<button class="btn btn-primary" ng-click="cancel()">Отмена</button>
	</div>
</script>

<script type="text/ng-template" id="delete.html">
	<div class="modal-body">
		<h4 class="modal-title modalTitle">Поддтвердите удаление</h4>
	</div>
	<div class="modal-footer">
		<button class="btn btn-danger" ng-click="save()">Удалить</button>
		<button class="btn btn-primary" ng-click="cancel()">Отмена</button>
	</div>
</script>

<script type="text/ng-template" id="addListMembers.html">
	<form name="addMembersForm" novalidate>
		<div class="modal-header">
			<h3 class="modal-title membersListTitle">Добавить участников</h3>
			<div class="form-group" ng-class="{ 'has-error' : userIsAlreadyInList || userIsNotExist }">
				<input type="email" name="email" class="form-control" placeholder="Введите email нового участника" ng-model="newMemberEmail" ng-change="userIsNotExist=false; userIsAlreadyInList=false" autofocus></input>
				<p ng-show="userIsNotExist" class="help-block">Пользователя с данным email не существует.</p>
				<p ng-show="userIsAlreadyInList" class="help-block">Пользователь уже является участником списка.</p>
			</div>
		</div>
		<div class="modal-body">
			<ul class="membersList">
				<li ng-repeat="member in user.lists[index].membersEmail">
					<span class="glyphicon glyphicon-user"></span>
					{{member}}
				</li>
			</ul>
		</div>
		<div class="modal-footer membersListFooter">
			<button class="btn btn-primary" ng-disabled="!newMemberEmail" ng-click="addMember()">Добавить</button>
			<button class="btn btn-primary" ng-click="cancel()">Готово</button>
		</div>
	</form>
</script>

<script type="text/ng-template" id="changeBackground.html">
	<div class="modal-body">
		<div class="changeBackground">
			<div>
				<div>
					<img src="img/background_1.jpg" ng-click="applyBackground('background_1.jpg')">
					<i ng-class="{ 'glyphicon glyphicon-ok': user.background=='background_1.jpg' }"></i>
				</div>
				<div>
					<img src="img/background_2.jpg" ng-click="applyBackground('background_2.jpg')">
					<i ng-class="{ 'glyphicon glyphicon-ok': user.background=='background_2.jpg' }"></i>
				</div>
				<div>
					<img src="img/background_3.jpg" ng-click="applyBackground('background_3.jpg')">
					<i ng-class="{ 'glyphicon glyphicon-ok': user.background=='background_3.jpg' }"></i>
				</div>
			</div>
			<div>
				<div>
					<img src="img/background_4.jpg" ng-click="applyBackground('background_4.jpg')">
					<i ng-class="{ 'glyphicon glyphicon-ok': user.background=='background_4.jpg' }"></i>
				</div>
				<div>
					<img src="img/background_5.jpg" ng-click="applyBackground('background_5.jpg')">
					<i ng-class="{ 'glyphicon glyphicon-ok': user.background=='background_5.jpg' }"></i>
				</div>
				<div>
					<img src="img/background_6.jpg" ng-click="applyBackground('background_6.jpg')">
					<i ng-class="{ 'glyphicon glyphicon-ok': user.background=='background_6.jpg' }"></i>
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/ng-template" id="changeListMembers.html">
	<form name="addMembersForm" novalidate>
		<div class="modal-header">
			<h3 class="modal-title membersListTitle">Изменить участников</h3>
			<div class="form-group" ng-class="{ 'has-error' : userIsAlreadyInList || userIsNotExist }">
				<input type="email" name="email" class="form-control" placeholder="Введите email нового участника" ng-model="newMemberEmail" ng-change="userIsNotExist=false; userIsAlreadyInList=false" autofocus></input>
				<p ng-show="userIsNotExist" class="help-block">Пользователя с данным email не существует.</p>
				<p ng-show="userIsAlreadyInList" class="help-block">Пользователь уже является участником списка.</p>
			</div>
		</div>
		<div class="modal-body">
			<ul class="membersList">
				<li ng-repeat="member in user.lists[index].membersEmail" class="clearfix">
					<span class="glyphicon glyphicon-user"></span>
					<span>{{member}}</span>
					<span class="glyphicon glyphicon-remove-circle" ng-click="removeUserFromList(member)" ng-show="member!=user.email"></span>
				</li>
			</ul>
		</div>
		<div class="modal-footer membersListFooter">
			<button class="btn btn-primary" ng-disabled="!newMemberEmail" ng-click="addMember()">Добавить</button>
			<button class="btn btn-primary" ng-click="cancel()">Готово</button>
		</div>
	</form>
</script>

<div id="app">

	<div id="sidebar">

		<div class="userInfo">
			<div class="btn-group" dropdown is-open="status.isopen">
				<button type="button" dropdown-toggle ng-disabled="disabled">
					{{user.firstName}} {{user.lastName}} <span class="caret"></span>
				</button>
				<ul class="dropdown-menu" role="menu">
					<li ng-click="accountSync()">Синхронизировать сейчас</li>
					<li>{{user.email}}</li>
					<li class="divider"></li>
					<li ng-click="changeBackground()">Сменить фон</li>
					<li class="divider"></li>
					<li ng-click="endSession()">Выйти</li>
				</ul>
			</div>
		</div>
		<div class="lists-scroll">
			<ul class="inbox" ng-show="user.inbox.length">
				<li ng-repeat="inboxList in user.inbox">
					<div>{{inboxList.listName}}</div>
					<span class="inboxButtons">
						<button class="btn btn-xs btn-primary" ng-click="confirmInboxList(inboxList)">
							<i class="glyphicon glyphicon-ok"></i>
						</button>
						<button class="btn btn-xs btn-danger" ng-click="rejectInboxList(inboxList)">
							<i class="glyphicon glyphicon-remove"></i>
						</button>
					</span>
				</li>
			</ul>
			<ul class="lists">
				<li ng-repeat="list in user.lists" ng-click="$parent.changeActiveList($index)" context-menu="$parent.menuOptions($index)" ng-class="{ 'active' : $parent.addActiveClass($index)}">
					<i ng-class="{'icon-file' : list.membersEmail.length==1, 'icon-copy' : list.membersEmail.length!=1}"></i>
					<span class="listName" popover="I appeared on mouse enter!" popover-trigger="mouseenter" popover-placement="right">{{list.listName}}</span>
					<span ng-show="calcNumberOfActiveTasks(list)" class="numberOfTasks">{{calcNumberOfActiveTasks(list)}}</span>
				</li>
			</ul>
		</div>
		<button class="btn btn-default add-list" ng-click="addList()">+</button>
	</div>

	<main id="main">
		<img ng-src="{{'img/' + user.background}}">
		<div ng-class="{ 'mainWidthTaskProperties': currentTaskNumber!==null }">
			<div>
				<input class="addTask" type="text" placeholder="Добавьте задачу" ng-model="newTaskName" ng-keyup="$event.keyCode == 13 && addTask()"></input>
			</div>
			<ul class="tasks">
				<li ng-repeat="task in user.lists[currentListNumber].tasks | reverse" ng-right-click="$parent.$parent.currentTaskNumber=user.lists[currentListNumber].tasks.length - 1 - $index" ng-show="!task.complited">
					<i class="icon-radio-unchecked" ng-click="$parent.changeTaskStatus(user.lists[currentListNumber].tasks.length - 1 - $index)"></i>
					<div>{{task.taskName}}</div>
				</li>
			</ul>
			<div class="showComplitedTasksButton" ng-click="showComplitedTasks=!showComplitedTasks" ng-show="calcNumberOfActiveTasks(user.lists[currentListNumber])!=user.lists[currentListNumber].tasks.length">Показать завершённые задачи</div>
			<ul class="tasks complitedTasks" ng-show="showComplitedTasks">
				<li ng-repeat="task in user.lists[currentListNumber].tasks | reverse" ng-right-click="$parent.$parent.currentTaskNumber=user.lists[currentListNumber].tasks.length - 1 - $index" ng-show="task.complited">
					<i class="icon-circle-check" ng-click="$parent.changeTaskStatus(user.lists[currentListNumber].tasks.length - 1 - $index)"></i>
					<div>{{task.taskName}}</div>
				</li>
			</ul>
		</div>
	</main>

	<div id="TaskProperties" ng-show="currentTaskNumber!==null">
		<div class="propertiesHeader">
			<i ng-class="{ 'icon-circle-check': user.lists[currentListNumber].tasks[currentTaskNumber].complited, 'icon-radio-unchecked': !user.lists[currentListNumber].tasks[currentTaskNumber].complited }" ng-click="changeTaskStatus(currentTaskNumber)"></i>
			<div>{{user.lists[currentListNumber].tasks[currentTaskNumber].taskName}}</div>
			<i class="glyphicon glyphicon-trash" ng-click="removeTask('sm')"></i>
			<i class="glyphicon glyphicon-remove-circle" ng-click="$parent.currentTaskNumber=null"></i>
		</div>
		<div class="propertiesBody">
			<div class="datepicker">
				<p class="input-group" ng-click="openDatepicker($event)">
					<input ng-change="updateDate()" placeholder="Установить срок" ng-disabled="true" type="text" class="form-control" datepicker-popup="dd.MM.yyyy" ng-model="user.lists[currentListNumber].tasks[currentTaskNumber].deadline" is-open="openedDatepicker" min-date="minDate" datepicker-options="dateOptions" ng-required="true" close-text="Закрыть" clear-text="Очистить" current-text="Сегодня">
					<span class="input-group-btn">
						<button type="button" class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button>
					</span>
				</p>
			</div>
			<div class="subtasks">
				<ul>
					<li ng-repeat="subtask in user.lists[currentListNumber].tasks[currentTaskNumber].subtasks">
						<i ng-class="{ 'glyphicon glyphicon-check': subtask.complited, 'glyphicon glyphicon-unchecked': !subtask.complited }" ng-click="changeSubtaskStatus($index)"></i>
						<input type="text" ng-model="subtask.subtaskName" ng-keyup="$event.keyCode == 13 && changeSubtask($index)" ng-blur="changeSubtask($index)"></input>
						<i class="glyphicon glyphicon-remove-circle" ng-click="removeSubtask(subtask, $index, 'sm')"></i>
					</li>
				</ul>
				<div>
					<i class="glyphicon glyphicon-plus"></i>
					<input type="text" ng-model="newSubtaskName" ng-keyup="$event.keyCode == 13 && addSubtask()" ng-blur="addSubtask()" placeholder="Добавить подзадачу"></input>
				</div>
			</div>
			<div class="description">
				<textarea placeholder="Добавить описание" ng-model="user.lists[currentListNumber].tasks[currentTaskNumber].description" ng-blur="updateDescription()"></textarea>
			</div>
			<div class="fileUpload">
				<div ng-file-drop ng-file-select ng-model="files" class="drop-box" 
				drag-over-class="dragover" ng-multiple="true" allow-dir="true"
				accept=".jpg,.png,.pdf">Добавить файл</div>
				<div ng-no-file-drop>Drag&Drop не поддерживается вашим браузером</div>
				<ul>
					<li ng-repeat="file in user.lists[currentListNumber].tasks[currentTaskNumber].attachments">
					<i class="glyphicon glyphicon-trash" ng-click="removeFile(file, $index, 'sm')"></i>
					<a target="_blank" ng-if="checkAttachments(file)" ng-href="{{'uploads/'+file.name}}">
						<img ng-src="{{'uploads/'+file.name}}"></a>
					<a target="_blank" ng-if="!checkAttachments(file)" ng-href="{{'uploads/'+file.name}}">
						<div class="file"><i class="glyphicon glyphicon-list-alt"></i>{{file.originalName}}</div>
					</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>